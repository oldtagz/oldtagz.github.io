<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>oldtagz</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body onload="loadPosters(); loadCheckout()">
    <button id="menu-button" onclick="openSlideOut('menu')"></button>
    <button id="checkout-button" onclick="openSlideOut('checkout')"></button>

    <section id="home">
      <h1 id="logo">
        <p>OLD</p>
        <p>TAG</p>
        <p>Z</p>
      </h1>
    </section>

    <section id="posters">
      <h2>Posters</h2>
      <h3>Edititon</h3>
      <h4>u:ma:mi</h4>
      <h5 id="posters-prints-amount"></h5>

      <div id="poster-images"></div>
    </section>

    <section id="about">
      <h2>ABOUT ME</h2>

      <div id="about-poem">
        <p>
          “Sometimes I stroll off from my beloved Bern, Seeking life, new flows
          and lessons to learn.<br />Amid highs and lows, I embrace my way,
          capturing light and gloom on each and every day.
        </p>

        <p>
          My lenses become my tools and creators of choice, like a sponge
          drenched in sight and noise.<br />I soak them up and make them mine,
          crafting stories, line by line.
        </p>

        <p>
          There's mystery in every frame, A hint of something more, untamed.<br />So,
          do come and join me on this fabulous ride, as we explore life's ebb
          and tide.”
        </p>
      </div>
    </section>

    <!-- slide out -->
    <div id="menu">
      <button
        onclick="closeSlideOut('menu')"
        id="menu-close-button"
        class="close"
      >
        &#9587;
      </button>

      <ul>
        <li><a href="#posters" onclick="closeSlideOut('menu')">POSTERS</a></li>
        <li><a href="#about" onclick="closeSlideOut('menu')">ABOUT</a></li>
      </ul>

      <div id="contact">
        <a id="email" href="mailto:kiry.loetscher@gmail.com">
          <button></button>
        </a>
        <a id="instagram" href="https://instagram.com/oldtagz" target="_blank">
          <button></button>
        </a>
      </div>
    </div>

    <div id="checkout">
      <h2>Shopping cart</h2>
      <button class="close" onclick="closeSlideOut('checkout')">&#9587;</button>

      <div id="checkout-poster-items"></div>
      <p id="checkout-total">
        Total: <span id="checkout-total-value"></span>CHF
      </p>

      <div id="checkout-actions">
        <button class="checkout-button">Checkout Instagram</button>
        <button class="checkout-button">Checkout Email</button>
      </div>
    </div>
  </body>

  <script src="./posters.js"></script>
  <script src="./cart.js"></script>
  <script>
    const loadCheckout = () => {
      const url = new URL(window.location);
      if (url.hash === "#checkout") openSlideOut("checkout");

      const cart = getCart();
      const list = document.getElementById("checkout-poster-items");
      for (let [poster, sizeAndAmount] of Object.entries(cart))
        for (let [size, amount] of Object.entries(sizeAndAmount))
          list.innerHTML += `
        <div class="poster-checkout">
          <h3>${POSTERS[poster]}</h3>
          <img src="./posters/${poster}.jpg" width="50" />
          <h4>Size:</h4>
          <select>
            <option>${size} cm</option>
          </select>
          <h4>Quantity:</h4>
          <input type="number" value="${amount}" />
        </div>`;

      document.getElementById("checkout-total-value").innerHTML =
        Object.entries(cart).reduce((acc, [poster, sizeAndAmount]) => {
          return (acc += Object.entries(sizeAndAmount).reduce(
            (acc, [size, amount]) => {
              return (acc += Number(SIZES[size]) * amount);
            },
            0
          ));
        }, 0);
    };

    const loadPosters = () => {
      const posters = document.querySelector("#poster-images");
      for (const [file, title] of Object.entries(POSTERS)) {
        posters.innerHTML += `
        <figure>
          <a href="./poster.html?poster=${file}" target="_blank">
            <img src="./posters/${file}.jpg" />
          </a>
          <figcaption>${title}</figcaption>
        </figure>
      `;
      }

      document.querySelector("#posters-prints-amount").innerHTML = `${
        Object.keys(POSTERS).length
      } Prints`;
    };

    let bodyMenuListener = () => closeSlideOut("menu");
    let bodyCheckoutListener = () => closeSlideOut("checkout");

    const openSlideOut = (id) => {
      document.getElementById(id).classList = "open slide-in";
      document.getElementById(`${id}-button`).style.opacity = "0";
      document.body.style.overflowY = "hidden";
      setTimeout(() => {
        document.body.addEventListener(
          "click",
          id === "menu"
            ? bodyMenuListener
            : id === "checkout"
            ? bodyCheckoutListener
            : null
        );
      }, 250);
    };

    const closeSlideOut = (id) => {
      document.body.removeEventListener("click", bodyMenuListener);
      document.body.removeEventListener("click", bodyCheckoutListener);
      const element = document.getElementById(id);
      document.getElementById(id).classList = "open slide-out";
      setTimeout(() => (element.classList = ""), 250);

      document.getElementById(`${id}-button`).style.opacity = "1";
      document.body.style.overflowY = "scroll";
    };
  </script>
</html>
