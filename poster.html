<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="./style.css" />
  </head>

  <body onload="loadPoster()">
    <h2 id="title"></h2>
    <h3>Edition</h3>
    <h4>u:ma:mi</h4>

    <img id="poster" />

    <div id="purchase">
      <div id="size-select">
        <p>Select size:</p>
        <div id="size-select-closed" onclick="openSizeSelect()">
          <span id="size-select-closed-selected"></span>
          <span class="down-arrow">&#9660;</span>
        </div>
      </div>

      <div id="size-select-open">
        <button>&#9587;</button>
        <p>Select Size:</p>
        <ul id="size-select-open-list"></ul>
      </div>

      <div
        class="add-to-cart"
        onclick="updateCart(state.poster, state.size, 1); window.location = '/#checkout'"
      >
        <span>Add to cart</span>
      </div>
    </div>
  </body>

  <script src="./posters.js"></script>
  <script src="./cart.js"></script>
  <script>
    let state = {
      slug: "",
      size: "",
    };

    const loadPoster = () => {
      const url = new URL(window.location);

      const poster = url.searchParams.get("poster");
      if (poster === null) window.history.back();

      state.poster = poster;
      state.size = Object.keys(SIZES)[0];

      const title = POSTERS[poster];
      document.title = title;
      document.getElementById("poster").src = `./posters/${poster}.jpg`;
      document.getElementById("title").innerHTML = title;
      setSizeSelected(state.size);

      for (const [size, price] of Object.entries(SIZES)) {
        document.getElementById(
          "size-select-open-list"
        ).innerHTML += `<li onclick=setSizeSelected("${size}")>${size}cm CHF${price},</li>`;
      }
    };

    const setSizeSelected = (size) => {
      state.size = size;

      window.scrollBy({
        top: -500,
        left: 0,
        behavior: "smooth",
      });

      document.getElementById("size-select").style.opacity = "1";
      document.getElementById("size-select").style.maxHeight = "200px";
      document.getElementById("size-select-open").style.opacity = "0";
      document.getElementById("size-select-open").style.maxHeight = "0";

      setTimeout(
        () =>
          (document.getElementById("size-select-open").style.display = "none"),
        500
      );
      document.getElementById(
        "size-select-closed-selected"
      ).innerHTML = `${size}cm, CHF${SIZES[size]},`;
    };

    const openSizeSelect = () => {
      document.getElementById("size-select").style.opacity = "0";
      document.getElementById("size-select").style.maxHeight = "0";
      document.getElementById("size-select-open").style.display = "block";
      document.getElementById("size-select-open").style.opacity = "1";
      document.getElementById("size-select-open").style.maxHeight = "500px";
      setTimeout(
        () =>
          window.scrollBy({
            top: 500,
            left: 0,
            behavior: "smooth",
          }),
        500
      );
    };
  </script>
</html>
